# WikiBot Reverse Proxy Configuration
# Caddy gère automatiquement les certificats SSL via Let's Encrypt

# Dashboard principal
wikibot-app.xyz {
    reverse_proxy dashboard:3000

    # Headers de sécurité
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        Referrer-Policy strict-origin-when-cross-origin
    }

    # Compression
    encode gzip zstd

    # Logs
    log {
        output stdout
        format console
    }
}

# API
api.wikibot-app.xyz {
    reverse_proxy api:4000

    # Headers CORS (gérés aussi par Express, mais backup)
    header {
        Access-Control-Allow-Origin https://wikibot-app.xyz
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization"
        X-Content-Type-Options nosniff
    }

    # Compression
    encode gzip zstd

    # Logs
    log {
        output stdout
        format console
    }
}

# Redirect www vers non-www
www.wikibot-app.xyz {
    redir https://wikibot-app.xyz{uri} permanent
}
